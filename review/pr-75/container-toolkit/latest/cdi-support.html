<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Support for Container Device Interface &mdash; NVIDIA Container Toolkit 1.16.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="_static/api-styles.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/mermaid-init.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/version.js"></script>
        <script src="_static/social-media.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Specialized Configurations with Docker" href="docker-specialized.html" />
    <link rel="prev" title="Architecture Overview" href="arch-overview.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="index.html">
  <img src="_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">NVIDIA Container Toolkit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-guide.html">Installing the Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="sample-workload.html">Running a Sample Workload</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported-platforms.html">Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Configuration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="arch-overview.html">Architecture Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Container Device Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="docker-specialized.html">Specialized Configurations with Docker</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NVIDIA Container Toolkit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
<li>
    <a href="https://docs.nvidia.com">NVIDIA Docs Hub</a>
    <i class="fa fa-chevron-right" aria-hidden="true"></i>
</li>
<li>
    <a href="https://docs.nvidia.com/datacenter/cloud-native/">NVIDIA Cloud Native Technologies</a>
    <i class="fa fa-chevron-right" aria-hidden="true"></i>
</li>
<li>Support for Container Device Interface</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="support-for-container-device-interface">
<span id="cdi-support"></span><h1>Support for Container Device Interface<a class="headerlink" href="#support-for-container-device-interface" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#about-the-container-device-interface" id="id1">About the Container Device Interface</a></p></li>
<li><p><a class="reference internal" href="#generating-a-cdi-specification" id="id2">Generating a CDI specification</a></p>
<ul>
<li><p><a class="reference internal" href="#prerequisites" id="id3">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#procedure" id="id4">Procedure</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-a-workload-with-cdi" id="id5">Running a Workload with CDI</a></p></li>
<li><p><a class="reference internal" href="#using-cdi-with-non-cdi-enabled-runtimes" id="id6">Using CDI with Non-CDI-Enabled Runtimes</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-the-cdi-mode-explicitly" id="id7">Setting the CDI Mode Explicitly</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#related-information" id="id8">Related Information</a></p></li>
</ul>
</div>
<section id="about-the-container-device-interface">
<h2>About the Container Device Interface<a class="headerlink" href="#about-the-container-device-interface" title="Permalink to this headline"></a></h2>
<p>As of the <code class="docutils literal notranslate"><span class="pre">v1.12.0</span></code> release the NVIDIA Container Toolkit includes support for generating Container Device Interface (CDI) specifications.</p>
<p>CDI is an open specification for container runtimes that abstracts what <em>access</em> to a device, such as an NVIDIA GPU, means, and standardizes access across container runtimes.
Popular container runtimes can read and process the specification to ensure that a device is available in a container.
CDI simplifies adding support for devices such as NVIDIA GPUs because the specification is applicable to all container runtimes that support CDI.</p>
<p>CDI also improves the compatibility of the NVIDIA container stack with certain features such as rootless containers.</p>
</section>
<section id="generating-a-cdi-specification">
<h2>Generating a CDI specification<a class="headerlink" href="#generating-a-cdi-specification" title="Permalink to this headline"></a></h2>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>You installed either the NVIDIA Container Toolkit or you installed the <code class="docutils literal notranslate"><span class="pre">nvidia-container-toolkit-base</span></code> package.
The base package includes the container runtime and the <code class="docutils literal notranslate"><span class="pre">nvidia-ctk</span></code> command-line interface, but avoids
installing the container runtime hook and transitive dependencies.
The hook and dependencies are not needed on machines that use CDI exclusively.</p></li>
<li><p>You installed an NVIDIA GPU Driver.</p></li>
</ul>
</section>
<section id="procedure">
<h3>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline"></a></h3>
<p>Two typical locations for CDI specifications are <code class="docutils literal notranslate"><span class="pre">/etc/cdi/</span></code> and <code class="docutils literal notranslate"><span class="pre">/var/run/cdi</span></code>.
However, the path to create and use can depend on the container engine that you use.</p>
<ol class="arabic">
<li><p>Generate the CDI specification file:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo nvidia-ctk cdi generate --output<span class="o">=</span>/etc/cdi/nvidia.yaml
</pre></div>
</div>
<p>The sample command uses <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to ensure that the file at <code class="docutils literal notranslate"><span class="pre">/etc/cdi/nvidia.yaml</span></code> is created.
You can omit the <code class="docutils literal notranslate"><span class="pre">--output</span></code> argument to print the generated specification to <code class="docutils literal notranslate"><span class="pre">STDOUT</span></code>.</p>
<p><em>Example Output</em></p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">INFO[0000] Auto-detected mode as &quot;nvml&quot;</span>
<span class="go">INFO[0000] Selecting /dev/nvidia0 as /dev/nvidia0</span>
<span class="go">INFO[0000] Selecting /dev/dri/card1 as /dev/dri/card1</span>
<span class="go">INFO[0000] Selecting /dev/dri/renderD128 as /dev/dri/renderD128</span>
<span class="go">INFO[0000] Using driver version xxx.xxx.xx</span>
<span class="go">...</span>
</pre></div>
</div>
</li>
<li><p>(Optional) Check the names of the generated devices:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nvidia-ctk cdi list
</pre></div>
</div>
<p>The following example output is for a machine with a single GPU that does not support MIG.</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">INFO[0000] Found 9 CDI devices</span>
<span class="go">nvidia.com/gpu=all</span>
<span class="go">nvidia.com/gpu=0</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you change the device or CUDA driver configuration, you must generate a new CDI specification.
A configuration change can occur when MIG devices are created or removed, or when the driver is upgraded.</p>
</div>
</section>
</section>
<section id="running-a-workload-with-cdi">
<h2>Running a Workload with CDI<a class="headerlink" href="#running-a-workload-with-cdi" title="Permalink to this headline"></a></h2>
<p>Using CDI to inject NVIDIA devices can conflict with using the NVIDIA Container Runtime hook.
This means that if a <code class="docutils literal notranslate"><span class="pre">/usr/share/containers/oci/hooks.d/oci-nvidia-hook.json</span></code> file exists, delete it
or ensure that you do not run containers with the <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code> environment variable set.</p>
<p>The use of the CDI specification is dependent on the CDI-enabled container engine or CLI that you use.
In the case of <code class="docutils literal notranslate"><span class="pre">podman</span></code>, for example, releases as of <code class="docutils literal notranslate"><span class="pre">v4.1.0</span></code> include support for specifying CDI devices in the <code class="docutils literal notranslate"><span class="pre">--device</span></code> argument.
Assuming that you genrated a CDI specification as in the preceding section, running a container with access to all NVIDIA GPUs would require the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>podman run --rm --device nvidia.com/gpu<span class="o">=</span>all --security-opt<span class="o">=</span><span class="nv">label</span><span class="o">=</span>disable ubuntu nvidia-smi -L
</pre></div>
</div>
<p>The preceding sample command should show the same output as running <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span> <span class="pre">-L</span></code> on the host.</p>
<p>The CDI specification also contains references to individual GPUs or MIG devices.
You can request these by specifying their names when launching a container, such as the following example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>podman run --rm <span class="se">\</span>
    --device nvidia.com/gpu<span class="o">=</span><span class="m">0</span> <span class="se">\</span>
    --device nvidia.com/gpu<span class="o">=</span><span class="m">1</span>:0 <span class="se">\</span>
    --security-opt<span class="o">=</span><span class="nv">label</span><span class="o">=</span>disable <span class="se">\</span>
    ubuntu nvidia-smi -L
</pre></div>
</div>
<p>The preceding sample command requests the full GPU with index 0 and the first MIG device on GPU 1.
The output should show only the UUIDs of the requested devices.</p>
</section>
<section id="using-cdi-with-non-cdi-enabled-runtimes">
<h2>Using CDI with Non-CDI-Enabled Runtimes<a class="headerlink" href="#using-cdi-with-non-cdi-enabled-runtimes" title="Permalink to this headline"></a></h2>
<p>To support runtimes that do not natively support CDI, you can configure the NVIDIA Container Runtime in a <code class="docutils literal notranslate"><span class="pre">cdi</span></code> mode.
In this mode, the NVIDIA Container Runtime does not inject the NVIDIA Container Runtime Hook into the incoming OCI runtime specification.
Instead, the runtime performs the injection of the requested CDI devices.</p>
<p>The NVIDIA Container Runtime automatically uses <code class="docutils literal notranslate"><span class="pre">cdi</span></code> mode if you request devices by their CDI device names.</p>
<p>Using Docker as an example of a non-CDI-enabled runtime, the following command uses CDI to inject the requested devices into the container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker run --rm -ti --runtime<span class="o">=</span>nvidia <span class="se">\</span>
    -e <span class="nv">NVIDIA_VISIBLE_DEVICES</span><span class="o">=</span>nvidia.com/gpu<span class="o">=</span>all <span class="se">\</span>
      ubuntu nvidia-smi -L
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code> environment variable indicates which devices to inject into the container and is explicitly set to <code class="docutils literal notranslate"><span class="pre">nvidia.com/gpu=all</span></code>.</p>
<section id="setting-the-cdi-mode-explicitly">
<h3>Setting the CDI Mode Explicitly<a class="headerlink" href="#setting-the-cdi-mode-explicitly" title="Permalink to this headline"></a></h3>
<p>You can force CDI mode by explicitly setting the <code class="docutils literal notranslate"><span class="pre">nvidia-container-runtime.mode</span></code> option in the NVIDIA Container Runtime config to <code class="docutils literal notranslate"><span class="pre">cdi</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo nvidia-ctk config --in-place --set nvidia-container-runtime.mode<span class="o">=</span>cdi
</pre></div>
</div>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES</span></code> environment variable is still used to select the
devices to inject into the container, but the <code class="docutils literal notranslate"><span class="pre">nvidia-container-runtime.modes.cdi.default-kind</span></code>
(with a default value of <code class="docutils literal notranslate"><span class="pre">nvidia.com/gpu</span></code>) is used to construct a fully-qualified CDI device name
only when you specify a device index such as <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">0</span></code>, or <code class="docutils literal notranslate"><span class="pre">1</span></code>, and so on.</p>
<p>This means that if CDI mode is explicitly enabled, the following sample command has the same effect as
specifying <code class="docutils literal notranslate"><span class="pre">NVIDIA_VISIBLE_DEVICES=nvidia.com/gpu=all</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker run --rm -ti --runtime<span class="o">=</span>nvidia <span class="se">\</span>
    -e <span class="nv">NVIDIA_VISIBLE_DEVICES</span><span class="o">=</span>all <span class="se">\</span>
      ubuntu nvidia-smi -L
</pre></div>
</div>
</section>
</section>
<section id="related-information">
<h2>Related Information<a class="headerlink" href="#related-information" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/cncf-tags/container-device-interface">Container Device Interface</a> (CDI) specification from the Container Device Interface repository on GitHub.</p></li>
<li><p><a class="reference external" href="https://github.com/cncf-tags/container-device-interface#how-to-configure-cdi">How to configure CDI</a> from the GitHub repository provides an overview
of manual configuration for CRI-O, containerd, and Podman.
The NVIDIA Container Toolkit performs the configuration for you.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="arch-overview.html" class="btn btn-neutral float-left" title="Architecture Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="docker-specialized.html" class="btn btn-neutral float-right" title="Specialized Configurations with Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
<img src="_static/NVIDIA-LogoBlack.svg" class="only-light"/>
<img src="_static/NVIDIA-LogoWhite.svg" class="only-dark"/>
<p class="notices">
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/" target="_blank">Privacy Policy</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/" target="_blank">Manage My Privacy</a>
|
<a href="https://www.nvidia.com/en-us/preferences/start/" target="_blank">Do Not Sell or Share My Data</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/" target="_blank">Terms of Service</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/accessibility/" target="_blank">Accessibility</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/company-policies/" target="_blank">Corporate Policies</a>
|
<a href="https://www.nvidia.com/en-us/product-security/" target="_blank">Product Security</a>
|
<a href="https://www.nvidia.com/en-us/contact/" target="_blank">Contact</a>
</p>
<p>
  Copyright &#169; 2020-2024, NVIDIA Corporation.
</p>

    <p>
      <span class="lastupdated">Last updated on Jul 30, 2024.
      </span></p>

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>