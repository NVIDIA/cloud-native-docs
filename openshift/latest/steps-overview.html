<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation and Upgrade Overview &mdash; NVIDIA GPU Operator on Red Hat OpenShift Container Platform 23.9.2 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="_static/api-styles.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/mermaid-init.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/design-tabs.js"></script>
        <script src="_static/version.js"></script>
        <script src="_static/social-media.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installing the Node Feature Discovery (NFD) Operator" href="install-nfd.html" />
    <link rel="prev" title="Prerequisites" href="prerequisites.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="index.html">
  <img src="_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation and Upgrade Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-nfd.html">Installing the Node Feature Discovery (NFD) Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-gpu-ocp.html">Installing the NVIDIA GPU Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvaie-with-ocp.html">NVIDIA AI Enterprise with OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="mig-ocp.html">MIG Support in OpenShift Container Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="clean-up.html">Cleanup</a></li>
<li class="toctree-l1"><a class="reference internal" href="mirror-gpu-ocp-disconnected.html">Deploy GPU Operators in a disconnected or airgapped environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable-gpu-monitoring-dashboard.html">Enabling the GPU Monitoring Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="enable-gpu-monitoring-dashboard.html#viewing-gpu-metrics">Viewing GPU Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="time-slicing-gpus-in-openshift.html">Time-slicing NVIDIA GPUs in OpenShift</a></li>
<li class="toctree-l1"><a class="reference internal" href="openshift-virtualization.html">NVIDIA GPU Operator with OpenShift Virtualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu-operator-with-precompiled-drivers.html">Precompiled Drivers for the NVIDIA GPU Operator for RHCOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting-gpu-ocp.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-ocp.html">Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NVIDIA GPU Operator on Red Hat OpenShift Container Platform</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
<li>
    <a href="https://docs.nvidia.com">NVIDIA Docs Hub</a>
    <i class="fa fa-chevron-right" aria-hidden="true"></i>
</li>
<li>
    <a href="https://docs.nvidia.com/datacenter/cloud-native/">NVIDIA Cloud Native Technologies</a>
    <i class="fa fa-chevron-right" aria-hidden="true"></i>
</li>
<li>Installation and Upgrade Overview</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation-and-upgrade-overview">
<span id="steps-overview"></span><h1>Installation and Upgrade Overview<a class="headerlink" href="#installation-and-upgrade-overview" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#high-level-steps" id="id2">High-Level Steps</a></p></li>
<li><p><a class="reference internal" href="#preparing-to-install-the-operator" id="id3">Preparing to Install the Operator</a></p>
<ul>
<li><p><a class="reference internal" href="#special-considerations-for-openshift-4-15" id="id4">Special Considerations for OpenShift 4.15</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id1" id="id5">Preparing to Install the Operator</a></p></li>
<li><p><a class="reference internal" href="#preparing-to-upgrade-the-operator" id="id6">Preparing to Upgrade the Operator</a></p></li>
<li><p><a class="reference internal" href="#about-the-broken-driver-toolkit" id="id7">About the Broken Driver Toolkit</a></p></li>
</ul>
</div>
<section id="high-level-steps">
<h2>High-Level Steps<a class="headerlink" href="#high-level-steps" title="Permalink to this headline"></a></h2>
<p>Follow these high-level steps to install an entitlement-free supported version of the NVIDIA GPU Operator:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="install-nfd.html#install-nfd"><span class="std std-ref">Installing the Node Feature Discovery (NFD) Operator</span></a>.</p></li>
<li><p><a class="reference internal" href="install-gpu-ocp.html#install-nvidiagpu"><span class="std std-ref">Installing the NVIDIA GPU Operator</span></a>.</p></li>
<li><p><a class="reference internal" href="install-gpu-ocp.html#running-sample-app"><span class="std std-ref">Running a sample GPU Application</span></a>.</p></li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The installation process for NVIDIA AI Enterprise customers is documented separately.
Refer to <a class="reference internal" href="nvaie-with-ocp.html"><span class="doc">NVIDIA AI Enterprise with OpenShift</span></a>.</p>
</div>
</section>
<section id="preparing-to-install-the-operator">
<h2>Preparing to Install the Operator<a class="headerlink" href="#preparing-to-install-the-operator" title="Permalink to this headline"></a></h2>
<p>You can deploy the Operator on a a newly deployed cluster that was not upgraded without entitlement on the following versions:</p>
<ul class="simple">
<li><p>OpenShift 4.9.9 and above z-streams</p></li>
</ul>
<section id="special-considerations-for-openshift-4-15">
<h3>Special Considerations for OpenShift 4.15<a class="headerlink" href="#special-considerations-for-openshift-4-15" title="Permalink to this headline"></a></h3>
<p>In OpenShift 4.15, secrets are no longer automatically generated when the integrated OpenShift image registry is disabled.
For more information, refer to the <a class="reference external" href="https://docs.openshift.com/container-platform/4.15/release_notes/ocp-4-15-release-notes.html#ocp-4-15-auth-generated-secrets">OpenShift 4.15 Release Notes</a>.</p>
<p>This change affects the installation of NVIDIA GPU Operator.
During installation, the Driver Toolkit daemon set checks for the existence of a <code class="docutils literal notranslate"><span class="pre">build-dockercfg</span></code> secret for the Driver Toolkit service account.
When the secret does not exist, the installation stalls.</p>
<p>You can run the following command to determine if your cluster is affected.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc get configs.imageregistry.operator.openshift.io cluster -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.storage}{&quot;\n&quot;}&#39;</span>
</pre></div>
</div>
<p>If the output from the preceding command is empty, <code class="docutils literal notranslate"><span class="pre">{}</span></code>, then your cluster is affected and you must configure your registry to use storage.
Refer to <a class="reference external" href="https://docs.openshift.com/container-platform/latest/registry/configuring_registry_storage/configuring-registry-storage-baremetal.html">Configuring the registry for bare metal</a>
for information about configuring the registry with a PVC.
For platforms other than bare metal, refer to the additional resources section of the <a class="reference external" href="https://docs.openshift.com/container-platform/latest/registry/configuring-registry-operator.html">Image Registry Operator in OpenShift Container Platform</a> page.</p>
<p>If the output from the preceding command is any value other than empty, your cluster is not affected.</p>
</section>
</section>
<section id="id1">
<h2>Preparing to Install the Operator<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Verify your cluster has the OpenShift Driver toolkit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc get -n openshift is/driver-toolkit
</pre></div>
</div>
<p><em>Example Output</em></p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">NAME             IMAGE REPOSITORY                                                            TAGS                           UPDATED</span>
<span class="go">driver-toolkit   image-registry.openshift-image-registry.svc:5000/openshift/driver-toolkit   410.84.202203290245-0,latest   47 minutes ago</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="preparing-to-upgrade-the-operator">
<h2>Preparing to Upgrade the Operator<a class="headerlink" href="#preparing-to-upgrade-the-operator" title="Permalink to this headline"></a></h2>
<p>After an upgrade a bug in OpenShift Cluster Version Operator (<a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=2014071">BZ#2014071</a>) prevents the proper upgrade of the Driver Toolkit image stream.
A fix for this issue has been merged in the following releases:</p>
<ul class="simple">
<li><p>OpenShift 4.8.21 and above z-streams</p></li>
<li><p>OpenShift 4.9.5 and above z-streams</p></li>
</ul>
<ol class="arabic">
<li><p>Verify your cluster is affected by this bug, search for a tag with an empty name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc get -n openshift is/driver-toolkit <span class="s1">&#39;-ojsonpath={.spec.tags[?(@.name==&quot;&quot;)]}&#39;</span>
</pre></div>
</div>
<p><em>Example Output</em></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="nt">&quot;annotations&quot;</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span><span class="nt">&quot;from&quot;</span><span class="p">:{</span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="s2">&quot;DockerImage&quot;</span><span class="p">,</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;[quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:71207482fa6fcef0e3ca283d0cafebed4d5ac78c62312fd6e19ac5ca2294d296](http://quay.io/openshift-release-dev/ocp-v4.0-art-dev@sha256:71207482fa6fcef0e3ca283d0cafebed4d5ac78c62312fd6e19ac5ca2294d296)&quot;</span><span class="p">},</span><span class="nt">&quot;generation&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="nt">&quot;importPolicy&quot;</span><span class="p">:{</span><span class="nt">&quot;scheduled&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;referencePolicy&quot;</span><span class="p">:{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;Source&quot;</span><span class="p">}}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>As a workaround, delete the broken image stream and the Cluster Version Operator recreates it:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc delete -n openshift is/driver-toolkit
</pre></div>
</div>
<p><em>Example Output</em></p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">imagestream.image.openshift.io &quot;driver-toolkit&quot; deleted</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="about-the-broken-driver-toolkit">
<span id="broken-dtk"></span><h2>About the Broken Driver Toolkit<a class="headerlink" href="#about-the-broken-driver-toolkit" title="Permalink to this headline"></a></h2>
<p>OpenShift 4.8.19, 4.8.21, 4.9.8 are known to have a broken Driver Toolkit image.
The following messages are recorded in the driver pod containers.
Follow the guidance in <a class="reference internal" href="appendix-ocp.html#cluster-entitlement"><span class="std std-ref">enabling a Cluster-wide entitlement</span></a>.
Afterward, the <code class="docutils literal notranslate"><span class="pre">nvidia-driver-daemonset</span></code> automatically uses an entitlement-based fallback.</p>
<p>To disable the use of Driver Toolkit image altogether, edit the cluster policy instance and set <code class="docutils literal notranslate"><span class="pre">driver.use_ocp_driver_toolkit</span></code> option to <code class="docutils literal notranslate"><span class="pre">false</span></code>.
Also, we recommend maintaining entitlements for OpenShift versions &lt; 4.9.9.</p>
<ol class="arabic">
<li><p>View the logs from the OpenShift Driver Toolkit container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc logs nvidia-driver-daemonset-49.84.202111111343-0-6mpw4 -c openshift-driver-toolkit-ctr
</pre></div>
</div>
<p><em>Example Output</em></p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">+ &#39;[&#39; -f /mnt/shared-nvidia-driver-toolkit/dir_prepared &#39;]&#39;</span>
<span class="go">Waiting for nvidia-driver-ctr container to prepare the shared directory ...</span>
<span class="go">+ echo Waiting for nvidia-driver-ctr container to prepare the shared directory ...</span>
<span class="go">+ sleep 10</span>
<span class="go">+ &#39;[&#39; -f /mnt/shared-nvidia-driver-toolkit/dir_prepared &#39;]&#39;</span>
<span class="go">+ exec /mnt/shared-nvidia-driver-toolkit/ocp_dtk_entrypoint dtk-build-driver</span>
<span class="go">Running dtk-build-driver</span>
<span class="go">WARNING: broken Driver Toolkit image detected:</span>
<span class="go">- Node kernel:    4.18.0-305.25.1.el8_4.x86_64</span>
<span class="go">- Kernel package: 4.18.0-305.28.1.el8_4.x86_64</span>
<span class="go">INFO: informing nvidia-driver-ctr to fallback on entitled-build.</span>
<span class="go">INFO: nothing else to do in openshift-driver-toolkit-ctr container, sleeping forever.</span>
</pre></div>
</div>
</li>
<li><p>View the logs from the NVIDIA Driver container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>oc logs nvidia-driver-daemonset-49.84.202111111343-0-6mpw4 -c nvidia-driver-ctr
</pre></div>
</div>
<p><em>Example Output</em></p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">Running nv-ctr-run-with-dtk</span>
<span class="go">+ [[ &#39;&#39; == \t\r\u\e ]]</span>
<span class="go">+ [[ ! -f /mnt/shared-nvidia-driver-toolkit/dir_prepared ]]</span>
<span class="go">+ cp -r /tmp/install.sh /usr/local/bin/ocp_dtk_entrypoint /usr/local/bin/nvidia-driver /usr/local/bin/extract-vmlinux /usr/bin/kubectl /usr/local/bin/vgpu-util /drivers /licenses /mnt/shared-nvidia-driver-toolkit/</span>
<span class="go">+ env</span>
<span class="go">+ sed &#39;s/=/=&quot;/&#39;</span>
<span class="go">+ sed &#39;s/$/&quot;/&#39;</span>
<span class="go">+ touch /mnt/shared-nvidia-driver-toolkit/dir_prepared</span>
<span class="go">+ set +x</span>
<span class="go">Wed Nov 24 13:36:31 UTC 2021 Waiting for openshift-driver-toolkit-ctr container to start ...</span>
<span class="go">WARNING: broken driver toolkit detected, using entitlement-based fallback</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="prerequisites.html" class="btn btn-neutral float-left" title="Prerequisites" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="install-nfd.html" class="btn btn-neutral float-right" title="Installing the Node Feature Discovery (NFD) Operator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2024, NVIDIA.
      <span class="lastupdated">Last updated on Apr 05, 2024.
      </span></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 



</body>
</html>